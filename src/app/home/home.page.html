<ion-header class="ion-no-border" *ngIf="!showWelcomeScreen">
  <ion-toolbar color="light">
    <ion-title color="primary" class="ion-text-center">Lunar Languages</ion-title>
    <ion-buttons slot="end">
      <ion-button color="primary" (click)="openLanguageSelector()">
        <span *ngIf="currentLanguage" style="font-size: 1.5rem; margin-right: 4px;">{{ currentLanguage.flag }}</span>
        <ion-icon name="globe-outline" *ngIf="!currentLanguage"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="false" *ngIf="!showWelcomeScreen">

  <app-display-panel
    [displayEnglish]="displayEnglish"
    [displayNative]="displayNative"
    [displayPhonetic]="displayPhonetic"
    [currentLanguage]="currentLanguage"
    [currentAudioId]="currentAudioId"
    [selectedStarter]="selectedStarter"
    (playAudio)="playAudio($event)">
  </app-display-panel>

  <div class="ion-padding-start ion-padding-end ion-margin-bottom">
    <!-- Row 1: Quick Phrases -->
    <ion-button expand="block" color="secondary" shape="round" (click)="setModalOpen(true)">
      <ion-icon name="flash" slot="start"></ion-icon>
      Quick Phrases
    </ion-button>

    <!-- Row 2: Culture & Numbers -->
    <div style="display: flex; gap: 10px; margin-top: 10px;" *ngIf="currentNotes.length > 0 || currentNumbers.length > 0">
      <ion-button *ngIf="currentNotes.length > 0" style="flex: 1;" expand="block" color="tertiary" shape="round" (click)="setNotesModalOpen(true)">
        <ion-icon name="book-outline" slot="start"></ion-icon>
        Culture
      </ion-button>

      <ion-button *ngIf="currentNumbers.length > 0" style="flex: 1;" expand="block" color="medium" shape="round" (click)="setNumbersModalOpen(true)">
        <ion-icon name="calculator-outline" slot="start"></ion-icon>
        Numbers
      </ion-button>
    </div>

    <!-- Row 3: Upgrade CTA -->
    <div class="ion-padding-top" *ngIf="(isPro$ | async) === false">
      <ion-button
        expand="block"
        class="upgrade-cta"
        shape="round"
        (click)="setUpgradeModalOpen(true)">
        <ion-icon slot="start" name="rocket"></ion-icon>
        GO PRO
      </ion-button>
    </div>
  </div>

  <app-quick-phrases-modal
    [isOpen]="isModalOpen"
    [essentials]="essentials"
    [isProUser]="isProUser"
    (didDismiss)="setModalOpen(false)"
    (phraseSelected)="selectEssential($event)">
  </app-quick-phrases-modal>

  <app-cultural-notes-modal
    [isOpen]="isNotesModalOpen"
    [notes]="currentNotes"
    (didDismiss)="setNotesModalOpen(false)">
  </app-cultural-notes-modal>

  <app-numbers-modal
    [isOpen]="isNumbersModalOpen"
    [numbers]="currentNumbers"
    [guidance]="currentNumberGuidance"
    (didDismiss)="setNumbersModalOpen(false)">
  </app-numbers-modal>

  <app-sentence-builder
    [starters]="starters"
    [visibleNouns]="visibleNouns"
    [selectedStarter]="selectedStarter"
    [selectedNoun]="selectedNoun"
    [isProUser]="isProUser"
    (starterSelected)="selectStarter($event)"
    (nounSelected)="selectNoun($event)">
  </app-sentence-builder>

  <div class="spacer-bottom"></div>

</ion-content>

<app-welcome-screen
  *ngIf="showWelcomeScreen"
  [availableLanguages]="availableLanguages"
  (languageSelected)="selectInitialLanguage($event)">
</app-welcome-screen>

<app-intro-modal
  *ngIf="showIntroModal"
  (dismiss)="dismissIntroModal()">
</app-intro-modal>

<app-upgrade-modal
  [isOpen]="isUpgradeModalOpen"
  [hasPendingSelection]="pendingProSelection !== null"
  (didDismiss)="setUpgradeModalOpen(false)"
  (upgradeTriggered)="upgradeToPro()">
</app-upgrade-modal>

